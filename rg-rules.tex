\begin{figure}[t]
%
\textbf{Expressions in \C{txn}$\langle i \rangle$} \quad 
\fbox {\( \rg{\mathbb{I},P,R}{\txnbox{e}_i}{G,C,Q} \)} \\
%\fbox{\( \rg{\mathbb{I},P,R}{\txnbox{c}_i}{G,Q}\)} \quad
%\fbox{\( \rg{\mathbb{I},P,R}{c}{G,Q}\)} \quad\\
%
\begin{minipage}{3in}
\rulelabel{RG-Var}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \stable(R,\I) \spc
  \I \vdash \mathtt{stable}(R,P) \spc
  \I \vdash \mathtt{stable}(R,Q) \\
  \hspace*{-0.6in}\forall \E,j,\eta,S,\E'.\; P(\E) \wedge j > \maxId(\E.\A)
    \conj S \subseteq \E.\A \\
  \conj \eta = (T_i,j,\C{RD}(X),\llbracket S \rrbracket(X))
    \conj \E' = \E \cup (\{\eta\},S\times\{\eta\}) \\
  \hspace*{0.4in}\conj \I(\E') \Rightarrow C(\llbracket S \rrbracket(X)) \wedge Q(\E') 
      \wedge G(\E,\E')
}
{
  \rg{\mathbb{I},P,R}{\txnbox{X}_i}{G,C,Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%

%
\begin{minipage}{3in}
\rulelabel{RG-Arith}
\begin{smathpar}
\begin{array}{c}
\RULE
{
% \I \vdash \mathtt{stable}(R,P) \spc
% \I \vdash \mathtt{stable}(R,Q) \\
  \forall v_1,v_2.\; C_1(v_1) \conj C_2(v_2) \Rightarrow
          C(v_1 \pm v_2)\\
  \rg{\mathbb{I},P,R}{\txnbox{e_1}_i}{G,C_1,Q'}\spc
  \rg{\mathbb{I},Q',R}{\txnbox{e_2}_i}{G,C_2,Q}
% G_1;G_2 \subseteq G
}
{
  \rg{\mathbb{I},P,R}{\txnbox{e_1 \pm e_2}_i}{G,C,Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%

%
\begin{minipage}{3in}
\rulelabel{RG-Conseq}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \I' \Rightarrow \I \spc 
  P' \Rightarrow P \spc
  Q \Rightarrow Q' \spc C \Rightarrow C'\\
  R' \subseteq R \spc G \subseteq G' \spc
  \rg{\mathbb{I},P,R}{\txnbox{e}_i}{G,C,Q}
}
{
  \rg{\mathbb{I'},P',R'}{\txnbox{e}_i}{G',C',Q'}
}
\end{array}
\end{smathpar}
\end{minipage}
%
\bigskip

%
\textbf{Commands in} \C{txn}$\langle i \rangle$\quad \fbox {\(
\rg{\mathbb{I},P,R}{\txnbox{c}_i}{G,Q} \)}\\
%
\begin{minipage}{3in}
\rulelabel{RG-Asgn}
\begin{smathpar}
\begin{array}{c}
\RULE
{
% \I \vdash \mathtt{stable}(R,P)\spc
  \rg{\I,P,R}{\txnbox{e}_i}{G,C,Q'}\\
  \stable(R,\I)\spc
  \I \vdash \mathtt{stable}(R,Q')\spc
  \I \vdash \mathtt{stable}(R,Q)\\
 \hspace*{-0.2in}\forall v,\E,j,\eta,S,\E'.~ C(v) \conj Q'(\E) 
    \conj j>\maxId(\E.\A) \conj S\subseteq \E.\A \\
 \hspace*{0.4in}\conj \eta = (T_i,j,\C{WR}(X),v)
    \conj \E' = \E \cup (\{\eta\},S\times\{\eta\})\\
 \hspace*{1in}\conj \I(\E') \Rightarrow Q(\E') \conj G(\E,\E') 
}
{
  \rg{\mathbb{I},P,R}{\txnbox{X:=e}_i}{G,Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%

\bigskip

%
\textbf{Top-Level Commands} \quad \fbox {\(\rg{\mathbb{I},P,R}{c}{G,Q} \)}\\
%

%
\begin{minipage}{3.5in}
\rulelabel{RG-Txn}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \rg{\mathbb{I},P,R}{\txnbox{c}_i}{G,Q'}\\
  \stable(R,\I)\spc
  \I \vdash \mathtt{stable}(R,Q)\spc
  \I \vdash \mathtt{stable}(R,Q')\\
  \hspace*{-0.5in}\forall \E,j,\eta,S,\E'.~Q'(\E) \conj j > \maxId(\E.\A) 
    \conj S \subseteq \E.\A \\
  \hspace*{0.4in} \eta = (T_i,j,\C{COMMIT},\bot) \conj \E' = \E \cup
    (\{\eta\},S\times\{\eta\}) \\
  \hspace*{1in}\conj \I(\E') \Rightarrow Q(\E') \conj G(\E,\E')\\
}
{
  \rg{\mathbb{I},P,R}{\ctxn{i}{c}}{G,Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%

\caption{\txnimp: Rely-Guarantee Rules}
\label{fig:rg-rules}
\end{figure}
