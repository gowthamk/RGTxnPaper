\begin{figure}[t]
\raggedright
%
\fbox {\( \R \vdash \hoare{P}{c}{Q} \)} 
\quad \fbox {\( \rg{I,R}{c}{G,I} \)}\\
%\fbox{\( \rg{\mathbb{I},P,R}{\txnbox{c}_i}{G,Q}\)} \quad
%\fbox{\( \rg{\mathbb{I},P,R}{c}{G,Q}\)} \quad\\
%
\begin{minipage}{3.2in}
\rulelabel{RG-Update}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \stable(\R,Q)\\
  \hspace*{-0.2in}\forall\stl,\stl',\stg.~P(\stl,\stg) \conj 
  \stl' = \stl \cup \{r' \,|\, \exists(r\in\Delta).~ [r/x]e_2 =\C{true} \\
        \hspace*{1.4in}\conj r'=[r/x]e_1\}
  \Rightarrow 
  Q(\stl',\stg)
}
{
  \R \vdash \hoare{P}{\updatee{\lambda x.e_1}{\lambda x.e_2}}{Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{3in}
\rulelabel{RG-Foreach}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \stable(\R,Q)\spc
  \stable(\R,I)\\
  P \wedge y=\emptyset \Rightarrow I\spc
  R \vdash \hoare{I \wedge z\in x}{c}{Q_c}\\
  Q_c \wedge z\in y \Rightarrow I\spc
  I \wedge y=x \Rightarrow Q
}
{
  \R \vdash \hoare{P}{\foreache{x}{\lambda y.\lambda z.c}}{Q}
}
\end{array}
\end{smathpar}
\end{minipage}
%
\bigskip

%
\begin{minipage}{3.9in}
\rulelabel{RG-Txn}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \stable(R,\I)\spc
  P(\stl,\stg) \Leftrightarrow \stl=\emptyset \wedge I(\stg)\\
  \R_r(\stl,\stg,\stg') \Leftrightarrow \I(\C{true},\stl,\stg,\stg') 
        \wedge R(\stg,\stg') \spc
  \R_r \vdash \rg{P}{c}{Q}\\
  \R_c(\stl,\stg,\stg') \Leftrightarrow \I(\C{false},\stl,\stg,\stg') 
        \wedge R(\stg,\stg') \spc
  \stable(\R_c,Q)\\
  \forall \stl,\stg.~ Q(\stl,\stg) \Rightarrow 
    G(\stg, \stl \gg \stg)\spc
  \forall \stg,\stg'.~I(\stg) \wedge G(\stg,\stg') \Rightarrow I(\stg')\\
}
{
  \rg{I,R}{\ctxn{i}{\I}{c}}{G,I}
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{2in}
\rulelabel{RG-Conseq}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \rg{I,R}{\ctxn{i}{\I}{c}}{G,I}\\
  \I' \Rightarrow \I \spc 
  R' \subseteq R \\
  \stable(R',\I')\spc
  G \subseteq G' \\
  \forall \stg,\stg'.~I(\stg) \wedge G'(\stg,\stg') \Rightarrow I(\stg')\\
}
{
  \rg{I,R'}{\ctxn{i}{\I'}{c}}{G',I}
}
\end{array}
\end{smathpar}
\end{minipage}
%

\caption{\small \txnimp: Rely-Guarantee Rules}
\label{fig:rg-rules}
\vspace*{-12pt}
\end{figure}
