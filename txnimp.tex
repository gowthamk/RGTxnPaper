\renewcommand{\ctxn}[3]{\C{TXN}_{#1}\langle #2 \rangle\{#3\}}
\begin{figure*}[!ht]
\raggedright
%
\textbf{Syntax}\\
%
\begin{smathpar}
\renewcommand{\arraystretch}{1.2}
\begin{array}{lclcl}
\multicolumn{5}{c} {
  {x,y} \in \mathtt{Variables}\qquad
  {f} \in \mathtt{Field\;Names} \qquad
% {\tau} \in \mathtt{Table\;Names}
  {i,j} \in \mathbb{N} \qquad
  {\odot} \in \{+,-,\le,\ge,=\}\qquad
}\\
\multicolumn{5}{c}{
  {k} \in \mathbb{Z} \qquad
  {\rec} \in \{\bar{f}=\bar{k}\}\qquad
  {\stl,\stg,s} \in \Pow{\rec} \qquad
  \I \in \mathbb{B}\times\Pow{\rec}\times\Pow{\rec}\times\Pow{\rec}
  \rightarrow \Prop
}\\
v & \in & \mathtt{Values} & \coloneqq & k \ALT \rec \ALT s\\
e & \in & \mathtt{Expressions} & \coloneqq & c \ALT x \ALT x.f 
    \ALT \{\bar{f}=\bar{e}\} \ALT e_1 \odot e_2\\ 
c & \in & \mathtt{Commands} & \coloneqq & \cskip \ALT \lete{x}{e}{c}
    \ALT \ite{e}{c_1}{c_2}\ALT c_1;c_2 \ALT \inserte{e}  \\
&&&&\ALT \deletee{\lambda x.e}
    \ALT \lete{x}{\selecte{\lambda x.e}}{c}
    \ALT \updatee{\bar{f}=\bar{e}}{\lambda x.e}\\
&&&&\ALT \foreache{e_1}{\lambda x.\lambda y. e_2} 
    \ALT \foreache{s_1 \cup s_2}{\lambda x.\lambda y. e}
    \ALT \ctxn{i}{\I}{ c } \ALT \ctxn{i}{\I,\stl,\stg}{c} \ALT c1 || c2\\
% t & \in & \mathtt{Terms} & \coloneqq & e \ALT c\\
\ectx & \in & \mathtt{Eval\;Ctx} & ::= & \bullet \ALT  
  \bullet || c_2 \ALT c_1 || \bullet \ALT \bullet;\,c_2 
  \ALT \ctxn{i}{\I,\stl,\stg}{\bullet} \\
\end{array}
\end{smathpar}
%
\bigskip

\renewcommand{\arraystretch}{1.2}

%
\textbf{Local Reduction} \quad 
\fbox {\(\stg \vdash (c,\stl) \stepsto (c',\stl')\)}\\
%
\begin{minipage}{2.8in}
\rulelabel{E-Insert}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  i \not\in \dom(\stl \cup \stg)\\
  r = \{\bar{f}=\bar{k};\,\idf=i;\,\delf=0\}
}
{
  \stg \vdash (\inserte{\{\bar{f}=\bar{k}\}},\stl) \stepsto
  (\cskip,\stl \cup \{r\})
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{2.8in}
\rulelabel{E-Delete}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  S = \{r' \,|\, \exists(r\in\Delta).~ \eval([r/x]e)=\C{true} \\
        \hspace*{0.7in}\conj r'=\{\bar{f}=r.\bar{f}; \idf=r.\idf; \delf=1\}\}
}
{
  \stg \vdash (\deletee{\lambda x.e},\stl) \stepsto (\cskip,\stl \cup S)
}
\end{array}
\end{smathpar}
\end{minipage}
%

%
\begin{minipage}{1.75in}
\rulelabel{E-Top-Ctx}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \\
  \underI{(t,\E) \stepsto (t',\E')}
}
{
  \I \vdash (\ectx\lbrack t \rbrack,\E) \tstepsto 
      (\ectx\lbrack t' \rbrack,\E')
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{1.4in}
\rulelabel{E-Txn-Ctx}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \\
  \underI{(\txnbox{t}_i,\E) \stepsto (t',\E')}
}
{
  \I \vdash (\ectx_i\lbrack t \rbrack,\E) \tstepsto 
      (\ectx_i\lbrack t' \rbrack,\E')
}
\end{array}
\end{smathpar}
\end{minipage}
%

%
\begin{minipage}{2.3in}
\vspace*{.2in}
\rulelabel{E-Var}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \mathcal{F} = \lambda S.\, (T_i,j,\C{RD}(X),\interp{S}(X))\\
  \underI{(\mathcal{F},\E) \redsto (v,\E')}
}
{
  \I \vdash (\txnbox{X}_i,\E) \tstepsto (v,\E')
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{2.3in}
\vspace*{.2in}
\rulelabel{E-Asgn}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \mathcal{F} = \lambda S.\, (T_i,j,\C{WR(X)},v)\\
  \underI{(\mathcal{F},\E) \redsto (v,\E')}
}
{
  \I \vdash (\txnbox{X:=v}_i,\E) \tstepsto (\cskip,\E')
}
\end{array}
\end{smathpar}
\end{minipage}
%
%
\begin{minipage}{2.5in}
\vspace*{.2in}
\rulelabel{E-Commit}
\begin{smathpar}
\begin{array}{c}
\RULE
{
  \mathcal{F} = \lambda S.\, (T_i,j,\C{COMMIT},\bot)\\
  \underI{(\mathcal{F},\E) \redsto (\bot,\E')}
}
{
  \I \vdash (\ctxn{i}{\cskip},\E) \stepsto (\cskip, \E')
}
\end{array}
\end{smathpar}
\end{minipage}
%

\caption{\small \txnimp: Syntax and Small-step semantics}
\label{fig:txnimp}
\end{figure*}

